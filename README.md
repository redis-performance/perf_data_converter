[![Github Action CI](https://github.com/google/perf_data_converter/workflows/ci/badge.svg)](https://github.com/google/perf_data_converter/actions)

# Introduction

The `perf_to_profile` binary can be used to turn a perf.data file, which is
generated by the linux profiler, perf, into a profile.proto file which can be
visualized using the tool pprof.

For details on pprof, see https://github.com/google/pprof

**THIS IS NOT AN OFFICIAL GOOGLE PRODUCT**

# Installation

## Option 1: APT Repository (Recommended for Ubuntu users)

For Ubuntu 20.04, 22.04, and 24.04 users, you can install `perf_data_converter` directly from our APT repository:

```bash
# Add the APT repository
echo "deb [trusted=yes] https://redis-performance.github.io/perf_data_converter focal main" | sudo tee /etc/apt/sources.list.d/perf_data_converter.list
echo "deb [trusted=yes] https://redis-performance.github.io/perf_data_converter jammy main" | sudo tee -a /etc/apt/sources.list.d/perf_data_converter.list
echo "deb [trusted=yes] https://redis-performance.github.io/perf_data_converter noble main" | sudo tee -a /etc/apt/sources.list.d/perf_data_converter.list

# Update and install
sudo apt-get update
sudo apt-get install perf-data-converter
```

The binary will be installed as `/usr/local/bin/perf_to_profile`.

For detailed APT repository documentation, see [docs/APT_REPOSITORY.md](docs/APT_REPOSITORY.md).

## Option 2: Build from Source

### Prerequisites to build
* Install dependencies

  ```
  sudo apt-get -y install g++ git libelf-dev libcap-dev
  ```
* At least g++-5 or clang-7

### Compile and Test
To install all dependences and build the binary, run the following commands.
These were tested on Ubuntu 14.04 LTS:

### Compile
* Install bazel by following the instructions [here](https://docs.bazel.build/versions/master/install.html).
* Install dependencies and build perf_to_profile using bazel

  ```
  git clone https://github.com/google/perf_data_converter.git
  cd perf_data_converter
  bazel build src:perf_to_profile
  ```

Place the `perf_to_profile` binary in a place accessible from your PATH (e.g. `/usr/local/bin`).


### Running tests
* There are a small number of tests that verify the basic functionality.
  To run these, after successful compilation, run:

  ```
  bazel test src:all
  bazel test src/quipper:all
  ```

Note: Executables generated using `bazel build` are available under the
directory `bazel-bin/`.

# Usage
* Profile a command using perf, for example:

  ```
  perf record /bin/ls
  ```

* Recent versions of pprof will automatically invoke `perf_to_profile`:

  ```
  pprof -web perf.data
  ```

* If you installed via APT, you can also use:

  ```
  perf_to_profile -i perf.data -o profile.pb
  pprof -web profile.pb
  ```

# Contribution
We appreciate your help!

Note that perf data converter and quipper projects do not use GitHub pull
requests, and that we use the issue tracker for bug reports.
